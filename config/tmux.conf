# ####################### #
#  MID LEVEL TMUX CONFIG  #
# ####################### #

# Enable mouse support (scrolling, resizing, selecting panes)
set -g mouse on
setw -g mouse on

# Use tmux-256color where available, otherwise fallback
# Use modern terminal features
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-256color:RGB"
set -g focus-events on


# ---- Move Between Panes ---- #

# Smooth pane navigation between tmux and Vim using Ctrl + h/j/k/l
bind -n C-M-h select-pane -L
bind -n C-M-j select-pane -D
bind -n C-M-k select-pane -U
bind -n C-M-l select-pane -R

bind -n C-M-Up select-pane -U    # Ctrl+Alt+Up to move up
bind -n C-M-Down select-pane -D  # Ctrl+Alt+Down to move down
bind -n C-M-Left select-pane -L  # Ctrl+Alt+Left to move left
bind -n C-M-Right select-pane -R # Ctrl+Alt+Right to move right



# ---- Copy Modes ---- #

# Use vi keys in copy mode
set -g mode-keys vi

# Clipboard integration (modern tmux supports set-clipboard)
set -g set-clipboard on

# Copy-mode bindings
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel
bind-key -T copy-mode-vi Enter send -X copy-selection-and-cancel

# Faster repeat-time for snappier split creation
set -s repeat-time 200

# ---- Window Pane Shortcuts ---- #

# Start new panes/windows in the current path
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"


# ---- Plugins ---- #

# Plugins: tpm, resurrect, continuum
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Auto-restore sessions and auto-save interval
set -g @continuum-restore 'on'
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-save-interval '15'  # minutes

# Initialize TMUX plugin manager (ensure path exists)
run-shell '~/.tmux/plugins/tpm/tpm'

# ---- Cheat Sheet (CTRL B + h) ---- #

# Popup cheatsheet binding - open a file at ~/.tmux/cheatsheet.txt
# Display popup if tmux supports display-popup (tmux >= 2.9)
bind-key h display-popup -E -w 73 -h 90% "bash -c 'clear; less ~/.tmux/cheatsheet.txt'"

# ------------------ #
#     Status Bar
# ------------------ #

# Status bar settings - use glyphs if you have a patched font; if not, visual will still work
set -g status on
set -g status-interval 5
set -g status-justify centre
set -g status-left-length 50
set -g status-right-length 150

# Colours (using terminal colour names)
set -g @color_bg_dark colour232
set -g @color_bg_dark_g colour239
set -g @color_fg_light colour231
set -g @color_user colour254
set -g @color_host colour252
set -g @color_date colour245
set -g @color_time colour252
set -g @color_accent0 colour233
set -g @color_accent1 colour208
set -g @color_accent2 colour39
set -g @color_accent3 colour5
set -g @color_accent4 colour234
set -g @color_doodle_bg colour2
set -g @color_doodle_fg colour255

set -g status-style "bg=#{@color_bg_dark},fg=#{@color_fg_light}"

# Left: session and user; fall back to ASCII doodle if glyphs missing
set -g status-left "\
#[bg=#{@color_accent1},fg=#{@color_accent0},bold]#S\
#[fg=#{@color_accent1},bg=#{@color_bg_dark}]\
#[fg=#{@color_bg_dark},bg=#{@color_bg_dark}]\
#[fg=#{@color_bg_dark},bg=#{@color_bg_dark_g}]\
#[fg=#{@color_user},bg=#{@color_bg_dark_g},bold] #(whoami) \
#[fg=#{@color_bg_dark},bg=#{@color_bg_dark_g}]\
#[fg=#{@color_doodle_bg},bg=#{@color_bg_dark}]\
#[fg=#{@color_doodle_fg},bg=#{@color_doodle_bg}]¯\\_(ツ)_/¯\
#[fg=#{@color_doodle_bg},bg=#{@color_bg_dark}]"

# Highlight current window
setw -g window-status-current-format "\
#[fg=#{@color_accent2},bg=#{@color_bg_dark}]\
#[fg=#{@color_bg_dark},bg=#{@color_accent2},bold]#I:#W\
#[fg=#{@color_accent2},bg=#{@color_bg_dark}]"

setw -g window-status-format "\
#[fg=#{@color_bg_dark},bg=#{@color_bg_dark_g}]\
#[bg=#{@color_bg_dark_g},fg=#{@color_fg_light}]#I:#W#[default]\
#[fg=#{@color_bg_dark_g},bg=#{@color_bg_dark}]"

# Right: host + date + time
set -g status-right "\
#[fg=#{@color_bg_dark},bg=#{@color_bg_dark_g}]\
#[fg=#{@color_host},bg=#{@color_bg_dark_g}]@#h\
#[fg=#{@color_bg_dark},bg=#{@color_bg_dark_g}]\
#[fg=#{@color_accent3},bg=#{@color_bg_dark}]\
#[fg=#{@color_date},bg=#{@color_accent3},bold]%y-%m-%d \
#[fg=#{@color_accent4},bg=#{@color_accent3}]λ\
#[fg=#{@color_time},bg=#{@color_accent3},bold] %H:%M #[default]\
#[fg=#{@color_bg_dark},bg=#{@color_accent3}]"

